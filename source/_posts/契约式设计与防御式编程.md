---
layout: post
title: 契约式设计、防御式设计（概念，实践，理解）
date: 2019-7-3
categories: blog
tags: [design]
description: 两种相对应的设计方式（复杂与简单之间的平衡）
---

契约式设计（英语：Design by Contract，缩写为 DbC），一种设计计算机软件的方法。这种方法要求软件设计者为软件组件定义正式的，精确的并且可验证的接口，这样，为传统的抽象数据类型又增加了先验条件、后验条件和不变式。这种方法的名字里用到的“契约”或者说“契约”是一种比喻，因为它和商业契约的情况有点类似。

子概念

-   先验条件：a 调用 b，要满足一定的条件
-   后验条件：a 调了 b 之后要返回满足 a 需要的东西
-   不变条件：还未理解（根据循环不变式也没有理解这里的不变是什么意思，什么作用）

[维基百科](https://zh.wikipedia.org/wiki/%E5%A5%91%E7%BA%A6%E5%BC%8F%E8%AE%BE%E8%AE%A1)


### 实践

接受一个接口的数据，这个数据一定不能为空，这个规则规定了之后，我这边就不需要处理一些特殊情况。

### 理解

这样做有助于减少边界情况的处理，也不需要写一些一辈子都跑不到的代码（不需要双方都处理很多边界条件）。

DbC 推荐使用断言来判断程序的正确性，但是单元测试应该是更有效的方式。Java 中的断言会阻断程序运行（一般都会吧），所以不适合应用在生产环境当中，生产环境还是要抛出异常比较合适，这也证明了单元测试更合适来验证程序的正确性。

### 防御式编程（与契约式设计相对）

防御性编程（Defensive programming）是防御式设计的一种具体体现，它是为了保证，对程序的不可预见的使用，不会造成程序功能上的损坏。它可以被看作是为了减少或消除墨菲定律效力的想法。防御式编程主要用于可能被滥用，恶作剧或无意地造成灾难性影响的程序上。

防御性编程通常通过一下途径，从而提高软件和源码的质量：

-   提高工程质量——减少 bug 和问题
-   提高源码可读性—— 源码应该变得可读且可理解，并且能经受代码审计。
-   让软件能通过预期的行为来处理不可预期的用户操作。

值得注意的是，过度的防御性编程可能会预防不可能会发生的错误，这样将导致运行时间与维护的损耗。当代码中拥有过多异常捕捉和异常处理，这有可能导致结果不正确或者被隐藏。
